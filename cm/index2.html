<!DOCTYPE html>
<html>
<head>
	<title>Concerts</title>
	<style>
		table {
			border-collapse: collapse;
			width: 100%;
		}

		th, td {
			border: 1px solid black;
			padding: 8px;
			text-align: left;
		}

		th {
			background-color: #ddd;
		}

		button {
			background-color: #4CAF50;
			border: none;
			color: white;
			padding: 8px 16px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
			margin: 4px 2px;
			cursor: pointer;
		}

		.collapsible {
			background-color: #f1f1f1;
			cursor: pointer;
			padding: 18px;
			width: 100%;
			border: none;
			text-align: left;
			outline: none;
			font-size: 15px;
		}

		.active, .collapsible:hover {
			background-color: #ccc;
		}

		.content {
			padding: 0 18px;
			display: none;
			overflow: hidden;
			background-color: #f1f1f1;
		}
	</style>
</head>
<body>
	<h2>Grouped by Concert Date</h2>
	<div id="grouped-by-concert-date"></div>
	<h2>Grouped by Composer</h2>
	<table id="grouped-by-composer">
		<thead>
			<tr>
				<th>Composer</th>
				<th>Piece</th>
				<th>Dates</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>

	<script>
		// Read CSV file and parse data
		fetch('concerts.csv')
			.then(response => response.text())
			.then(text => {
				let rows = text.split('\n').map(row => row.split(','));
				let data = {};
				rows.forEach(row => {
					let date = row[0];
					let composer = row[1];
					let piece = row[2];
					if (!data[date]) {
						data[date] = [];
					}
					data[date].push({composer, piece});
				});

				// Display grouped by concert date view
				let groupedByConcertDate = document.getElementById('grouped-by-concert-date');
				Object.entries(data).forEach(([date, pieces]) => {
					let div = document.createElement('div');
					let h3 = document.createElement('h3');
					h3.innerText = date;
					div.appendChild(h3);
					pieces.forEach(piece => {
						let p = document.createElement('p');
						p.innerText = `${piece.composer}: ${piece.piece}`;
						div.appendChild(p);
					});
					groupedByConcertDate.appendChild(div);
				});

				// Display grouped by composer view
				let groupedByComposer = document.getElementById('grouped-by-composer');
				let composers = {};
				Object.entries(data).forEach(([date, pieces]) => {
					pieces.forEach(piece => {
						let composer = piece.composer;
						if (!composers[composer]) {
							composers[composer] = [];
						}
						composers[composer].push({piece: piece.piece, date: date});
					});
				});
				Object.entries(composers).forEach(([
					composer, pieces]) => {
						let tr = document.createElement('tr');
						let composerCell = document.createElement('td');
						let composerButton = document.createElement('button');
						composerButton.innerText = composer;
						composerButton.classList.add('collapsible');
						composerCell.appendChild(composerButton);
						tr.appendChild(composerCell);
						let pieceCell = document.createElement('td');
						let pieceList = document.createElement('ul');
						pieces.forEach(piece => {
                            let pieceItem = document.createElement('li');
                            pieceItem.innerText = piece.piece;
                            pieceList.appendChild(pieceItem);
                        });
						pieceCell.appendChild(pieceList);
						tr.appendChild(pieceCell);
						let dateCell = document.createElement('td');
						let dateList = document.createElement('ul');
						pieces.forEach(piece => {
                            let dateItem = document.createElement('li');
                            dateItem.innerText = piece.date;
                            dateList.appendChild(dateItem);
						});
						dateCell.appendChild(dateList);
						tr.appendChild(dateCell);
						groupedByComposer.querySelector('tbody').appendChild(tr);

                // Add event listener to button
				composerButton.addEventListener('click', function() {
					this.classList.toggle('active');
					let content = this.nextElementSibling;
					if (content.style.display === 'block') {
						content.style.display = 'none';
					} else {
						content.style.display = 'block';
					}
				});

				// Hide piece list by default
				pieceList.parentElement.classList.add('content');
			});
		})
		.catch(error => console.log(error));
</script>
</body>
</html>
